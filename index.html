<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa de Predicciones</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1IjoiZXNtZXJhbGRhbSIsImEiOiJjbTc0cGF1Z2swZDBoMmpxeTJ3czg3cDEzIn0.cTCbN8IRIrxTelPv4lVKDQ";
      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/dark-v10",
        center: [-72.2119, 14.6311],
        zoom: 2,
      });

      map.on("load", function () {
        map.addSource("geojson-source", {
          type: "geojson",
          data: "https://esmemag96.github.io/GeoJson-MVP/data.geojson",
        });

  // Capa de puntos mejorada
  map.addLayer({
    id: 'circle-layer',
    type: 'circle',
    source: 'geojson-source',
    paint: {
      // Color del punto basado en el nivel de riesgo
      'circle-color': [
        'match',
        ['get', 'risk_level'],
        'Alto', '#FF5733',
        'Medio', '#FFC300',
        'Bajo', '#DAF7A6',
        '#AAAAAA'
      ],
      'circle-radius': [
        'interpolate',
        ['linear'],
        ['get', 'estimated_migrants'],
        0, 5,
        5000, 20
      ],
      'circle-opacity': 0.8,
      'circle-stroke-width': 1,
      'circle-stroke-color': '#000'
    }
  });

  // Pop-up para mostrar detalles al hacer clic en un punto
  map.on('click', 'circle-layer', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const properties = e.features[0].properties;

    const description = `
      <strong>Ciudad:</strong> ${properties.city}<br>
      <strong>País:</strong> ${properties.country}<br>
      <strong>Nivel de riesgo:</strong> ${properties.risk_level}<br>
      <strong>Descripción:</strong> ${properties.event_description}<br>
      <strong>Migrantes estimados:</strong> ${properties.estimated_migrants}<br>
      <strong>Módulos necesarios:</strong> ${properties.modules_needed}<br>
      <strong>Ruta logística:</strong> ${properties.logistics_route}
    `;

    new mapboxgl.Popup()
      .setLngLat(coordinates)
      .setHTML(description)
      .addTo(map);
  });

  // Cambiar el cursor a "pointer" cuando pase sobre un punto
  map.on('mouseenter', 'circle-layer', function() {
    map.getCanvas().style.cursor = 'pointer';
  });

  // Volver el cursor a "default" cuando salga del punto
  map.on('mouseleave', 'circle-layer', function() {
    map.getCanvas().style.cursor = '';
  });
});
    </script>
  </body>
</html>
